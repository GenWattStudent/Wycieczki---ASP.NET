@using Book.App.Helpers
@using Book.App.ViewModels
@model HomeViewModel

@{
    ViewData["Title"] = "BOOKMANIA - Home Page";
}

<div>
    @if (Model.Tour != null && Model.Book != null)
    {
        var sliderData = new ImageSliderModel { Images = Model.Tour.Images, SliderId = Model.Tour.Id };
        <div class="alert alert-primary" role="alert" id="tour-info">
            <div class="d-flex">
                <partial name="_ImageSliderPartial" model="@sliderData" />
                <a asp-action="Details" asp-controller="Book" asp-route-id="@Model.Tour.Id">
                    <h4>@Model.Tour.Name</h4>
                </a>
            </div>
            <p data-toggle="tooltip" data-placement="top" title="@Model.Tour.Description">
                @Model.Tour.Description.Truncate(150)</p>
            <partial name="_TourStatusPartial" model="@Model.Book" />
            <strong class="d-flex align-items-center gap-2">
                <ion-icon name="calendar-number"></ion-icon>
                Start at @Model.Tour.StartDate
            </strong>

            <div class="rounded" id="earth"></div>
        </div>
    }

    <div class="text-center">
        <h1>Explore the World with Exciting Tours!</h1>
        <img class="img-fluid rounded mt-4" src="~/images/landscape2.jpg" alt="">
        <p class="mt-4"><span class="h4">W</span>elcome to our world of adventure! Embark on unforgettable journeys and
            discover the beauty of
            diverse
            destinations with our curated selection of tours. Whether you seek cultural immersion, thrilling outdoor
            experiences, or simply a relaxing getaway, we have the perfect itinerary for you. Join us as we delve into
            breathtaking landscapes, delve into rich histories, and create lasting memories. Let's turn your travel
            dreams
            into reality!
        </p>
        <cite>
            <span class="text-primary">"Explore the World with Exciting Tours!"</span> - Your Gateway to Unforgettable
            Adventures.
        </cite>
    </div>
    <button class="btn btn-primary mt-4">
        <a class="text-light text-decoration-none" asp-action="Tours" asp-controller="Tour">
            Explore Tours
        </a>
    </button>
</div>

@section Scripts {
    <script type="module">
        import EarthScene from './js/three/earth.js';
        import { Waypoint } from './js/Waypoint.js';
        import { latLongToVector3 } from './js/three/helpers.js';

        const waypoints = @Html.Raw(Json.Serialize(Model.Tour.Waypoints));
        const earthScene = new EarthScene();
        const waypointsObj = [];

        function getTypeFromEnum(type) {
            switch (type) {
                case 0:
                    return 'start'
                case 1:
                    return 'marker'
                case 2:
                    return 'end'
                case 4:
                    return 'indicator'
                default:
                    return 'road'
            }
        }

        waypoints.$values.forEach(waypoint => {
            const waypointData = new Waypoint(
                waypoint.latitude,
                waypoint.longitude,
                waypoint.id,
                waypoint.name,
                waypoint.description,
                getTypeFromEnum(waypoint.type),
                waypoint.images,
                true,
                waypoint.isRoad
            )

            waypointsObj.push(waypointData);
        });

        earthScene.earth.setWaypoints(waypointsObj)
        earthScene.setHeight(250)
        earthScene.setWidth($('#tour-info').width())
        earthScene.enableZoom(true)
        earthScene.earth.loadAssets().then(() => {
            earthScene.earth.drawEarth()

            earthScene.earth.setTextureBasedOnTime()
            earthScene.earth.drawRoad()
            earthScene.earth.isAnimate = false
            earthScene.earth.zoom = 5.2
            earthScene.earth.updateCamera(latLongToVector3(waypointsObj[ 0 ].lat, waypointsObj[ 0 ].lng, earthScene.earth.earthRadius, 0.01))
            earthScene.animate()
        })
    </script>
}
